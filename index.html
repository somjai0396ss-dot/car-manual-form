<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Download ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏£‡∏ñ</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Sarabun', sans-serif; background-color: #f9f9f9; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
    .container { background-color: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); width: 100%; max-width: 450px; }
    h2 { margin-top: 0; margin-bottom: 10px; font-size: 28px; color: #000; font-weight: 700; }
    p.sub-head { color: #666; margin-bottom: 30px; font-size: 16px; }
    
    label { display: block; margin-bottom: 6px; color: #555; font-size: 14px; font-weight: 500; }
    
    /* Input Box Style */
    input[type="text"], input[type="email"], input[type="tel"] { 
      width: 100%; padding: 14px; margin-bottom: 5px; /* ‡∏•‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏î‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏¥‡∏î */
      border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; outline: none; 
      transition: border-color 0.3s;
    }
    input:focus { border-color: #000; }
    
    /* Style ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏Ç‡∏≠‡∏ö‡πÅ‡∏î‡∏á + ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏î‡∏á‡∏≠‡πà‡∏≠‡∏ô) */
    input.invalid { border-color: #e74c3c !important; background-color: #fff8f8; }

    /* ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏µ‡πÅ‡∏î‡∏á */
    .error-text {
      color: #e74c3c;
      font-size: 13px;
      margin-bottom: 15px;
      display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô */
      text-align: left;
    }

    .checkbox-container { display: flex; align-items: flex-start; margin-bottom: 5px; margin-top: 15px; font-size: 14px; color: #333; }
    .checkbox-container input { margin-top: 4px; margin-right: 12px; transform: scale(1.2); }
    
    button { background-color: #000; color: white; width: 100%; padding: 16px; border: none; border-radius: 50px; font-size: 18px; font-weight: bold; cursor: pointer; transition: background 0.3s; margin-top: 10px; }
    button:hover { background-color: #333; }
    button:disabled { background-color: #ccc; cursor: not-allowed; }
    .footer { text-align: center; margin-top: 25px; color: #999; font-size: 12px; }
    @media (max-width: 600px) { .container { padding: 30px 20px; } h2 { font-size: 24px; } }
  </style>
</head>
<body>

  <div class="container">
    <h2>Download ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏£‡∏ñ</h2>
    <p class="sub-head">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠</p>

    <form id="downloadForm" novalidate>
      <input type="hidden" id="model" name="model">

      <label>‡∏ä‡∏∑‡πà‡∏≠ ‚Äì ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
      <input type="text" id="name" name="name" placeholder="Your name">
      <div class="error-text" id="err-name">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</div>

      <label>Email</label>
      <input type="email" id="email" name="email" placeholder="you@email.com">
      <div class="error-text" id="err-email">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>

      <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
      <input type="tel" id="phone" name="phone" placeholder="08x-xxx-xxxx" maxlength="10">
      <div class="error-text" id="err-phone">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 10 ‡∏´‡∏•‡∏±‡∏Å</div>

      <div class="checkbox-container">
        <input type="checkbox" id="consent" name="consent">
        <span>‡∏â‡∏±‡∏ô‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö </span>
      </div>
      <div class="error-text" id="err-consent" style="margin-bottom: 20px;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</div>

      <button type="submit" id="btnSubmit">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠ &rarr;</button>
    </form>
    
    <div class="footer">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö</div>
  </div>

  <script>
    // -----------------------------------------------------------
    // üî¥ ‡∏ß‡∏≤‡∏á URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Google Apps Script ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏µ‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzAQTxS5ADOjzwzz5uyixZvHM0SuQjhnH0l3FU68vS1Nc6iQEf2VlEWY2FRxZA2B8LvFA/exec'; 
    // -----------------------------------------------------------

    const urlParams = new URLSearchParams(window.location.search);
    const modelFromUrl = urlParams.get('model') || "";
    document.getElementById('model').value = modelFromUrl;

    const form = document.getElementById('downloadForm');
    const btn = document.getElementById('btnSubmit');

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Validation)
    function validateForm() {
      let isValid = true;

      // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏ä‡∏∑‡πà‡∏≠ (‡∏´‡πâ‡∏≤‡∏°‡∏ß‡πà‡∏≤‡∏á)
      const name = document.getElementById('name');
      const errName = document.getElementById('err-name');
      if (name.value.trim() === "") {
        name.classList.add('invalid');
        errName.style.display = 'block';
        isValid = false;
      } else {
        name.classList.remove('invalid');
        errName.style.display = 'none';
      }

      // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏≠‡∏µ‡πÄ‡∏°‡∏• (Format ‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)
      const email = document.getElementById('email');
      const errEmail = document.getElementById('err-email');
      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailPattern.test(email.value)) {
        email.classList.add('invalid');
        errEmail.style.display = 'block';
        isValid = false;
      } else {
        email.classList.remove('invalid');
        errEmail.style.display = 'none';
      }

      // 3. ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏£‡∏ö 10 ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏õ‡πä‡∏∞‡πÜ)
      const phone = document.getElementById('phone');
      const errPhone = document.getElementById('err-phone');
      const phoneVal = phone.value.replace(/\D/g, ''); // ‡∏ï‡∏±‡∏î‡∏Ç‡∏µ‡∏î ‡∏ï‡∏±‡∏î‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ‡∏≠‡∏≠‡∏Å ‡∏ô‡∏±‡∏ö‡πÅ‡∏Ñ‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
      if (phoneVal.length !== 10) {
        phone.classList.add('invalid');
        errPhone.style.display = 'block';
        isValid = false;
      } else {
        phone.classList.remove('invalid');
        errPhone.style.display = 'none';
      }

      // 4. ‡∏ï‡∏£‡∏ß‡∏à Checkbox ‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°
      const consent = document.getElementById('consent');
      const errConsent = document.getElementById('err-consent');
      if (!consent.checked) {
        errConsent.style.display = 'block';
        isValid = false;
      } else {
        errConsent.style.display = 'none';
      }

      return isValid;
    }

    // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á
    form.addEventListener('submit', e => {
      e.preventDefault();

      // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô
      if (!validateForm()) {
        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡∏´‡∏¢‡∏∏‡∏î‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
        return; 
      }

      btn.innerHTML = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";
      btn.disabled = true;

      // ‡∏ñ‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheet
      fetch(scriptURL, { method: 'POST', body: new FormData(form)})
        .then(response => {
           // ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à -> ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ PDF
           redirectToPDF(document.getElementById('model').value);
        })
        .catch(error => {
           console.error('Error!', error.message);
           // ‡∏ñ‡πâ‡∏≤ Error (‡πÄ‡∏ä‡πà‡∏ô‡πÄ‡∏ô‡πá‡∏ï‡∏´‡∏•‡∏∏‡∏î) ‡∏Å‡πá‡∏¢‡∏±‡∏á‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
           redirectToPDF(document.getElementById('model').value);
        });
    });

    function redirectToPDF(modelCode) {
      var pdfLinks = {
        "Nexi": "https://drive.google.com/file/d/176BzRWMbCgFNKiYgHfF5VW_BF6zIFrH0/view?usp=sharing",
        "Vink": "https://drive.google.com/file/d/1EM_RBW6XqpOVycDKMduTkfH07nUetLyd/view?usp=sharing",
        "Ren": "https://drive.google.com/file/d/1dP6zPRT1nRkPkRCBRMm6A9zNOn7d5vwd/view?usp=sharing",
        "Ying": "https://drive.google.com/file/d/1A4D91rJCbVpAd8pr958xXRDGgFJcte1e/view?usp=sharing",
        "Mew": "https://drive.google.com/file/d/1gA5igltOxVCULbjot_UplMj9GSq4Z2JG/view?usp=sharing",
        "Slice": "https://drive.google.com/file/d/1FUXx2l15O9lqrLO9_oxq-nd5j_vrDENI/view?usp=sharing"
      };

      var targetUrl = "";
      if(modelCode) {
        for (var key in pdfLinks) {
          if (key.toLowerCase() === modelCode.trim().toLowerCase()) {
            targetUrl = pdfLinks[key];
            break;
          }
        }
      }

      if (targetUrl) {
        window.location.href = targetUrl;
      } else {
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ)");
        window.location.reload();
      }
    }
  </script>

</body>
</html>
